sap.ui.define(["sap/ui/core/mvc/Controller","no/meriton/BarcodeGenerator/util/jsBarcode","no/meriton/BarcodeGenerator/util/qrCode","no/meriton/BarcodeGenerator/model/formatter","sap/ui/unified/ColorPickerPopover","sap/ui/unified/library","sap/ui/core/library"],function(e,t,i,s,o,l,r){"use strict";var d=l.ColorPickerMode,n=l.ColorPickerDisplayMode;return e.extend("no.meriton.BarcodeGenerator.controller.Main",{formatter:s,onInit:function(){var e=this.getView().byId("titValid"),t=this.getView().byId("vBoxQrCode"),i=this.getView().byId("vBoxBarCode"),s=this.getView().byId("imgBarcode"),o=this.getView().byId("inValue"),l=this.getView().byId("sliWidth"),r=this.getView().byId("sliHeight"),d=this.getView().byId("sliScale"),n=this.getView().byId("inpBackgroundColor"),a=this.getView().byId("inpLineColor"),g=this.getView().byId("vbVisibleText"),V=this.getView().byId("vbVisibleTextShowControl"),h=this.getView().byId("segButVisability"),u=this.getView().byId("segButPosition"),b=this.getView().byId("inpFontSize"),f=this.getView().byId("inpFontMargin"),y=this.getView().byId("selType");this.signalAfterRendering="QR";this.lastRenderedControl="BR";s.addEventDelegate({onAfterRendering:function(){if(this.signalAfterRendering==="BR"){if(this.lastRenderedControl==="QR"){n.setValue("#f7f7f7");a.setValue("#2b0d0d");V.setVisible(true);this.lastRenderedControl="BR"}if(h.getSelectedKey()==="false"){g.setVisible(false)}else{g.setVisible(true)}JsBarcode("#"+s.getId(),o.getValue(),{format:y.getSelectedKey(),background:n.getValue(),width:l.getValue(),height:r.getValue(),displayValue:h.getSelectedKey(),lineColor:a.getValue(),textAlign:u.getSelectedKey(),fontSize:b.getValue(),textMargin:f.getValue(),valid:function(t){if(t){e.setVisible(false);s.setVisible(true);s.removeStyleClass("Hidden");o.setValueState("None")}else{e.setVisible(true);s.setVisible(false);s.addStyleClass("Hidden");o.setValueState("Error")}}.bind(this)})}}},this);t.addEventDelegate({onAfterRendering:function(){if(this.signalAfterRendering==="QR"){if(this.lastRenderedControl==="BR"){n.setValue("#000000");a.setValue("#ffffff");g.setVisible(false);V.setVisible(false);this.lastRenderedControl="QR"}this.qrCode=new QRCode($("#"+t.getId())[0],{width:d.getValue(),height:d.getValue(),colorDark:n.getValue(),colorLight:a.getValue(),correctLevel:QRCode.CorrectLevel.H});this.qrCode._htOption.colorDark=n.getValue();this.qrCode._htOption.colorLight=a.getValue();o.setValueState("None");e.setVisible(false);s.setVisible(true);s.removeStyleClass("Hidden");this.qrCode.makeCode(o.getValue())}}},this);this.rerenderControl()},onLiveChange:function(){this.rerenderControl()},rerenderControl:function(){var e=this.getView().byId("imgBarcode"),t=this.getView().byId("vBoxBarCode"),i=this.getView().byId("vBoxQrCode"),s=this.getView().byId("gridScaleQR"),o=this.getView().byId("gridScaleBR"),l=this.getView().byId("selType");if(l.getSelectedKey()==="QR"){this.signalAfterRendering="QR";e.setVisible(false);t.setVisible(false);i.setVisible(true);s.setVisible(true);o.setVisible(false);i.rerender()}else{this.signalAfterRendering="BR";e.setVisible(true);t.setVisible(true);i.setVisible(false);s.setVisible(false);o.setVisible(true);e.rerender()}},openSimplifiedModeSample:function(e){this.inputId=e.getSource().getId();if(!this.oColorPickerSimplifiedPopover){this.oColorPickerSimplifiedPopover=new o("oColorPickerSimpplifiedPopover",{colorString:"#f7f7f7",displayMode:n.Simplified,mode:d.HSL,change:this.handleChange.bind(this)})}this.oColorPickerSimplifiedPopover.openBy(e.getSource())},handleChange:function(e){var t=this.getView(),i=t.byId(this.inputId);i.setValue(e.getParameter("hex"));i.setValueState("None");this.inputId="";this.rerenderControl()},onReset:function(){var e=this.getView().byId("selType");this.getView().byId("inValue").setValue();this.getView().byId("sliHeight").setValue(70);this.getView().byId("sliScale").setValue(128);if(e.getSelectedKey()==="QR"){this.getView().byId("inpBackgroundColor").setValue("#000000");this.getView().byId("inpLineColor").setValue("#ffffff");this.getView().byId("vbVisibleText").setVisible(false);this.getView().byId("vbVisibleTextShowControl").setVisible(false)}else{this.getView().byId("inpBackgroundColor").setValue("#f7f7f7");this.getView().byId("inpLineColor").setValue("#2b0d0d");this.getView().byId("inpFontMargin").setValue(10);this.getView().byId("inpFontSize").setValue(20);this.getView().byId("segButPosition").setSelectedKey("center");this.getView().byId("segButVisability").setSelectedKey("true");this.getView().byId("vbVisibleTextShowControl").setVisible(true)}this.rerenderControl()},onPrint:function(){var e="width=1200px, height=400px",t=window.open("","Print",e),i="",s=this.getView().byId("imgBarcode"),o=this.getView().byId("vBoxQrCode"),l=this.getView().byId("selType");if(l.getSelectedKey()==="QR"){i=$("#"+o.getId())[0].outerHTML}else{i=$("#"+s.getId())[0].outerHTML}t.document.write(i);t.document.close();t.focus();t.print()}})});